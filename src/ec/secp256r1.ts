import {
    and,
    hash256,
    assert,
    unpack,
    reverseBytes,
    SmartContractLib,
    method,
    lshift,
    prop,
    toByteString,
    FixedArray,
    ByteString,
} from 'scrypt-ts'

import { Point, Signature } from './misc'

export class SECP256R1 extends SmartContractLib {
    @prop()
    static readonly CURVE_BITS = 256n

    // Curve coefficients:
    @prop()
    static readonly a =
        115792089210356248762697446949407573530086143415290314195533631308867097853948n
    @prop()
    static readonly b =
        41058363725152142129326129780047268409114441015993725554835256314039467401291n

    // Generator point:
    @prop()
    static readonly G: Point = {
        x: 48439561293906451759052585252797914202762949526041747995844080717082404635286n,
        y: 36134250956749795798585127919587881956611106672985015071877198253568414405109n,
    }

    // Curve order:
    @prop()
    static readonly n =
        115792089210356248762697446949407573529996955224135760342422259061068512044369n

    // Curve field value:
    @prop()
    static readonly P =
        115792089210356248762697446949407573530086143415290314195533631308867097853951n

    // Upper bound of the eGCD mod inverse loop:
    @prop()
    static readonly UB = 368n

    // Precalculated doublings for the generator point
    @prop()
    static readonly DOUBLINGS_G: FixedArray<Point, 256> = [
        {
            x: 56515219790691171413109057904011688695424810155802929973526481321309856242040n,
            y: 3377031843712258259223711451491452598088675519751548567112458094635497583569n,
        },
        {
            x: 102369864249653057322725350723741461599905180004905897298779971437827381725266n,
            y: 101744491111635190512325668403432589740384530506764148840112137220732283181254n,
        },
        {
            x: 44710890534849379681007195543719586089737754824560621976448707498688874787731n,
            y: 78410552107786285403689301656392479612049391334024095564584156230482213311870n,
        },
        {
            x: 53672045248057889115442990650974246956111433509949227817154447498898850675822n,
            y: 76677617734363509249014819591226621404800471122547084603525198673829417472272n,
        },
        {
            x: 16042583733306269684101352870536626105169720449307277134008003609085624635617n,
            y: 32399114438360517224045093278977987173122871862196854131348009719644938621618n,
        },
        {
            x: 4534198767316794591643245143622298809742628679895448054572722918996032022405n,
            y: 38538856030597174617352966265796180312895426960288118979288294421866280361154n,
        },
        {
            x: 78814614752662803446552508042186487658791282954521013490681246482080340428022n,
            y: 12674104618141790467894299044247475822858341166545530384190000277770750348115n,
        },
        {
            x: 23807964934059478435436331776350117849069612297768742934782236087921044112411n,
            y: 86241443812278992969236146751152550194975751834835207077668085446343782543686n,
        },
        {
            x: 2156549495952774314111151774178377948559693241906339406709973036473601988830n,
            y: 22115702523015271602572671974768413662894969172470766522001632807566541942422n,
        },
        {
            x: 10213448892841498040343822488579379905132019463394398194763674400840732494343n,
            y: 104774171927457593387914541038977971788686657480131065027322895015444410926119n,
        },
        {
            x: 79653716915665900061201781630580858916862475427086596591346770818198939780544n,
            y: 56231866189639730753959129374618610980738706597653232502602271548117074579564n,
        },
        {
            x: 104524345245415168844760228505523029502954337505467828479846741403274911766335n,
            y: 24068680205777287268608992964267617520729588536215884430823708440404643944657n,
        },
        {
            x: 40863224036474936141631142071715333457001814331027501250884046861033018586291n,
            y: 3386129191566091291470497666167764336438333215168340315524161147129268811747n,
        },
        {
            x: 42025154672100618091302854432090563247905244644296387999148687757182615160575n,
            y: 94723202283272416307777814951919253088047486446376176713972625696391150511635n,
        },
        {
            x: 51404187157962378176336921896360819578142209723616955715127248788275781410748n,
            y: 89443666980066831661724560541201252349280700609614168942421156125843984449387n,
        },
        {
            x: 72412835798008492899815071849086056607001213471145009021285164652312939848644n,
            y: 102554733615261634604727271955114922528443021960973746229359109862289549224144n,
        },
        {
            x: 92944812916383591202226840127989918871695072688526711036159737013721541185837n,
            y: 60553895363376070190549143159633388307375388321283848599920050874556475421615n,
        },
        {
            x: 6952618527003531675296994356776297463183372546461849043464102571127989153562n,
            y: 112471650221151969856728932103620803121465996982724043976638783413918408814746n,
        },
        {
            x: 32161590388091230361947227126565844676608389367196975631576458973464081232315n,
            y: 15471909706627164928854461425101131289995033829824593821518099868480843627020n,
        },
        {
            x: 6684372531644321906066043092760334574549429214674163067658680787578763272177n,
            y: 96855569752147665018863380411147536628722905149448873330403642614010621941036n,
        },
        {
            x: 32325296723778932716908442300219159473750757983906220472533718577210510587849n,
            y: 20736800745816317547941100211167809857392517429255853975351510004630564684767n,
        },
        {
            x: 24080838673251189267224641055261777485302758319343856506760599936121160768910n,
            y: 70782045015843204772139723009081065570680123181450092687981893546901991795586n,
        },
        {
            x: 100267549038796000079648997458834901227245220848193549513967878156264533967000n,
            y: 5009797542289624972333303858064459697507098334052838364352435118597123504984n,
        },
        {
            x: 112607987952473600112633811304579709354947280056396786048007260552010776369157n,
            y: 103808385594532261808417197518044123929568276946600525334048096014844982592250n,
        },
        {
            x: 72865994191103900368418452717911508270166796327302686479698375787037649393830n,
            y: 47739020510692012294675537081390407274995880016472573531102395326084814450736n,
        },
        {
            x: 114337602657105746566520026766062898895613036501521397712923213318745566291214n,
            y: 22031670490518099985769479050822638414518110334638301895014522352320470045858n,
        },
        {
            x: 16615211420998207844953991634261826615548584246702138675453794230699003829763n,
            y: 96151858191390696272824414073643418914225141229386506707267472495832706137165n,
        },
        {
            x: 49374035672028068292423893253679785830248540621612537385650116037466511257021n,
            y: 79256956600639487529482899901486295393487541625893452108323742222982335905023n,
        },
        {
            x: 94621550900186240532768349089227166281668476405190589251681615248255539160074n,
            y: 23612451419535512356446731195296399189245073635318629801499671275538232646231n,
        },
        {
            x: 79605922378474623973159959507572628590432813470264327202418311886589301128670n,
            y: 45965289954538637928972426711663391846762557009143098280278750794428678321058n,
        },
        {
            x: 59803630658580911635110414367064981923647105428749033779659313567020126510931n,
            y: 68101072679436867230445935848898376370573937333418965600767120482840390450091n,
        },
        {
            x: 57845546284519137759868071879580864747474048681904255205518830050186748385603n,
            y: 104300214627605143922035278089265480928211230602089785806215194357861799731457n,
        },
        {
            x: 44085625625751170997932929574909966714690074232301662476579011373627984738498n,
            y: 35645972748133380066322357524322937317880031863658880554940323484064822317775n,
        },
        {
            x: 37140787262028868400603529939790768554691799788219928578313549867109173793604n,
            y: 96798710045581238073789867434157945472105501227220075607838500459701780022858n,
        },
        {
            x: 10594137538693159652362091171356991542397050116906952495087384776117218954892n,
            y: 94758752783907129712819126875928968033324008756528099419259112727705165623711n,
        },
        {
            x: 47672558290532994745606111302302651538498283638269219397602278605586832438341n,
            y: 94867063319150901357067400799860287583849347994908388285755732313936488648979n,
        },
        {
            x: 70394508083814053707822294125039777511790450241686416796865823183639134744814n,
            y: 1729641103391955907655968377364823991891840114418956455292264076825465207902n,
        },
        {
            x: 90940736396790475425613002904842443104987174680982002157426337101460581740837n,
            y: 2566610551532426969428871345699115218984184183954849027894409522539994516884n,
        },
        {
            x: 4764696280192400883221331787057373028230172199538291789864176535062649296894n,
            y: 9820546020427560942572663944249101220461157953302479761405503737224250138577n,
        },
        {
            x: 7117219637401806100122437217092395421691934786284425072844278260020446687165n,
            y: 85713522139911406441953761439054025020922327004638518913134088988167330274464n,
        },
        {
            x: 59055270174441822758478814482695419890994525104726167224995534831704867097428n,
            y: 104318946643816363131190608884452534126609888147098254002136781558768071599788n,
        },
        {
            x: 88903766336201506088115816679473865038348116670988949189760810642503689128480n,
            y: 85267677868722309678005669084531845988689240570652934941317199782325964482395n,
        },
        {
            x: 68976200874485400814839055316575475839191802479069568337650140848737063921613n,
            y: 64487111187886730719347116993058964395720714286911672967435459313764167988694n,
        },
        {
            x: 46151386089676163142443307350143913580927961174619246086868745153938464860082n,
            y: 73121122757423339297241739518803061767818842171918612944384071331655674264104n,
        },
        {
            x: 51001789499975713870896499258945299800625183671501582054647652632925849566335n,
            y: 112107631690450252130469657172853833693744021398041101679580067852789929130070n,
        },
        {
            x: 22015896689737633135298272054205076693797267085997266668499061834140107015106n,
            y: 97057693492855511082830237583213522514387730536482712458949226756974877360003n,
        },
        {
            x: 41488367985469674040333633335546824248261247458703511079902432205422828491142n,
            y: 11135580625302119209331738144269057617177872359844135342454608012193283940376n,
        },
        {
            x: 98092631963333567695581428574760586152002567019959164777040722049080886644996n,
            y: 21630765968448461105271151841110683038982663250507450270450825045654914336973n,
        },
        {
            x: 94191848408181169074137813991709920985269238347957361924755286705472452864027n,
            y: 36534840748100237052976650886096809542190277077434526256676057396262916872039n,
        },
        {
            x: 115001542534026106307498157946053857765679488252158784395121370516628696341523n,
            y: 3659759752835115882774670478626118842833037727714457094676371783290200306606n,
        },
        {
            x: 90939949929741517826402960963940452953309789774759840282332190582768314936897n,
            y: 44759564930584666506549645053441388812183631018808661116304500250357198733742n,
        },
        {
            x: 38356105094062366809423889594679526005605475747493644899773194991524873395331n,
            y: 12783575202917423625090003389417727692075501728076887429940081096544504845985n,
        },
        {
            x: 18946419459529237599144414140795810029312787230345997823203963969037178272805n,
            y: 105960633513380686428756267795040383594496140110452753860977918855425124983918n,
        },
        {
            x: 95269209607852943473926630889635985316585667125507260596344374306953306022787n,
            y: 55030285771491461064866741440503732938337921036913047864849917516347374175808n,
        },
        {
            x: 89299698105954643260939132392039398519190810953798082845924918712987837281577n,
            y: 109764783960534524401447797640070315000093113169656316366735630233157069251062n,
        },
        {
            x: 89225862004345790356528446323174017721198182957844604012241004401242540288310n,
            y: 95209934060019944793889086016910086133023171690774878270761621044126749999060n,
        },
        {
            x: 94304727294008872320042403474375458343283744754230586832216129780893333992121n,
            y: 53963577210563612212286208562636702109866284333058400600891687124241514909532n,
        },
        {
            x: 30530109832546949563291072633237490682702220197180510755871054234698498669457n,
            y: 43381088763700662767802768260912630742025626299410305266963285547801129713715n,
        },
        {
            x: 93540413700623658546645096225335583132917940819934819508146551695353566779847n,
            y: 66553410968472659013405047846813886808377942344559186268211579649093631776306n,
        },
        {
            x: 16333331113077745551914379003289873044123401881177123100133193804355138420040n,
            y: 29241633486126050976148618152544163714698979701491433373303329441624776604424n,
        },
        {
            x: 35566857649637311184185360472160831632857921043009859157581423723030417111932n,
            y: 89679616176193680024228408430200049339466134219010929128392111089062050652478n,
        },
        {
            x: 70798126503552505028325083728551589239989406736620190723846694424650083405102n,
            y: 67484526175822092932671571313099982778865709876803650108779133407797397642536n,
        },
        {
            x: 18789094111258407606200383453492446143214340758016769876768723182934748965619n,
            y: 11296582853499417076204273153571890116089443265011563804718664008338011471254n,
        },
        {
            x: 7081762767697287976009771493310263771290289599581147299482766892475312560995n,
            y: 86823381773038968119624426030239743822549553315161612703449942820586000887527n,
        },
        {
            x: 1403810242890032554906673779515655599274985018625350083539101873235480762293n,
            y: 61617330936628764714622260330634195070720938392958707125897027654601041724413n,
        },
        {
            x: 75575531629274745007335764177410035508313646274703454097862075897420372976418n,
            y: 21955907770975270990108027390670941864966904856959906600160357358861987348457n,
        },
        {
            x: 12664176886671006937092610814702120170909999477704514076958036156844397994624n,
            y: 18775773912656001976453433019659509194737985910615436289323902351500805640801n,
        },
        {
            x: 38326617985334122145287133833787365179848932245086343383876581470457805040007n,
            y: 34002171646248121748226003096151680616808448922282199504428812615423058685513n,
        },
        {
            x: 14120644800832635771581209527685319770345790120608474596616177855417794560592n,
            y: 80204468014722610916537110325245004173785491784647197204106371424032112318805n,
        },
        {
            x: 69620190028769907988114457844823015756766412828704787723067357248189765682394n,
            y: 114120243359837995995868555172309656029191784371832769499402110110191796444332n,
        },
        {
            x: 49444368894449942689798474104848280343447872201657272808419974946854314532867n,
            y: 92705494712783155051727681405659242233264515277931094524386652253861971924636n,
        },
        {
            x: 13212105601100510411178965927701641127252901966803032931296236503164112265777n,
            y: 90071079968428487887086919557028894780640441813301232398042267138458717170801n,
        },
        {
            x: 50282744466039126204684446089044107964648855413184282713402332807759669702034n,
            y: 4890490971078743054564569753619651762560813779736896076627583759478302014623n,
        },
        {
            x: 61081236242968393165085705033850768932433494757724424363241391384870228253685n,
            y: 53039772600274763181283135848011980447114856786273898031140488589830739954915n,
        },
        {
            x: 99473627103954925204587657969899514778904153231071229537881655957372086020851n,
            y: 112331881878933563670408362942890025290783279759530973375452752083344004629485n,
        },
        {
            x: 38831166751134635229676669537023695940695849203018692182211543303806438494047n,
            y: 47852399746477357543314344308034935255111371291035989515361114272799132319152n,
        },
        {
            x: 63533008733356901928928737382503287035946597676994259851098138427803163883771n,
            y: 92811500390778828290941742790808553962582956229772012698222859950292128965382n,
        },
        {
            x: 28816506798349405421057165507313235948471896011210625296662119270183214903765n,
            y: 38265612273490661969005645846757389446953746576640651907438793477143449136325n,
        },
        {
            x: 88333174695364152432655389384380823349092735429118113487009677470940329917567n,
            y: 102193076146491008977824964491269929204406264562072253177433000723382009333444n,
        },
        {
            x: 49828575028116926929291416935656016227672925058314425183204974794407737923148n,
            y: 23672863131373800715754284801418136550634499790773327485690127428126502803599n,
        },
        {
            x: 64670243072488182309083637675850599229555158058488182911904111801556481363364n,
            y: 16347040928502130372421191541499475006727710106554749997500935978560902490579n,
        },
        {
            x: 94456855010494555552440144192924074572436223566067192579687977130564714677454n,
            y: 107454288142064281403790598049810048768824905072000029693673836220145431598777n,
        },
        {
            x: 59075510389762786246894585687971236018603318115991189958469010514887801666882n,
            y: 95439642134561558448882044914984071388416656725589714122934734427059631642130n,
        },
        {
            x: 115347579640600920359788707297554606783708244921412036995207111277466512462464n,
            y: 30388593972955084424483596119721965876678424000071845172305422386130325813529n,
        },
        {
            x: 40059288344788619573995439509607021762404873297983609465918952368225603803655n,
            y: 92552173297437165147005422684671999900626462011300171480674103398697335788512n,
        },
        {
            x: 50172420389930957701569790485815345756983793897675145648634170632485876534316n,
            y: 9377232390683218582656469991375635806207244624154194508688432319170470726962n,
        },
        {
            x: 72769812168963572357519761977891653901508911019543157737761569314003658720597n,
            y: 13642520148160337739379980009116267174344317033287148778488902458861847080333n,
        },
        {
            x: 103365466470076108927944452739687362217644273769883589823091557398990243049040n,
            y: 37085166945523027654288719515866511111043056876916268075215569955140458713213n,
        },
        {
            x: 47778071650846031682050533554644994585906688383051175626143043787387226893856n,
            y: 75892105296273959786155724543462011575837130638080497601891083200924862213263n,
        },
        {
            x: 99815451718953184772307378979340395218797725661315523999234214493645858180465n,
            y: 63297575474148792429197381681711685247280156210622996711984081824913783520498n,
        },
        {
            x: 98591304838538012984692063225136700174039985492361043183529747936808038673750n,
            y: 3468032692571332584467366329599130844659391128197486569840509706494218625465n,
        },
        {
            x: 110416452182133351008613682613335583721551192831616156633026306491303997837688n,
            y: 104325981612628535813053275230229904677043373338950462918632190843763244545361n,
        },
        {
            x: 26749029274556838110751205902112058713285802296287347837438302938405586639691n,
            y: 42490925245704601509275698368579473468564088252293302163264185366517468106575n,
        },
        {
            x: 107035477423683986002078662557791710836396410230364299853241559162109774080673n,
            y: 71655825153096566570744798773517374573541382546403306373578653556894678986403n,
        },
        {
            x: 41880304899756953101068023713428356752271459982082789768206781868450197524543n,
            y: 32212516077659575353950640019511658181726824780578391496808464477699248696231n,
        },
        {
            x: 33632488769642950967021600273968758828948451862976580774715929826193342341518n,
            y: 106327573413143454726973223825755236374448084397347156576106396005572147099712n,
        },
        {
            x: 92526094732269649457360928425372045858852182995329162371720398134584374286402n,
            y: 88041658731913477540819873560804247571673127635390235618646017227450859192519n,
        },
        {
            x: 8043579701724146371642946376818547246615170737926623319881092779927898937940n,
            y: 59234944194076169456006180009823269563660918722076683372730854377620438400501n,
        },
        {
            x: 70776904805796960023266441764225708366113142802791497820596466298020629679987n,
            y: 73622136806538492486973361904143738075649989055332587885946074341207083643202n,
        },
        {
            x: 21123657732602187397701201956540699538084697725338440868048720063467017350640n,
            y: 28569476275119917998578362467928166321329493721530282289513053525326196697774n,
        },
        {
            x: 95520204653251155037244916856007255862274248478757642446878702266389102346894n,
            y: 48814489581600432597790629922888267428172734911744122735417145524420273496408n,
        },
        {
            x: 104152129141351181882565024390840381625247171263258939634371404733790091699757n,
            y: 85250368984822265576968429218842014147675037750835811751209701257634424214929n,
        },
        {
            x: 75152425446962415178819696095775045174452418334010226132936453276087507569765n,
            y: 84823086660060382389164465293322030406464235412077074039996111032438658898201n,
        },
        {
            x: 57420640154133845039497834392177297957514616735403271126116002396327270721504n,
            y: 79477240558435729206654018530853216235658723743830549399789455872863532400788n,
        },
        {
            x: 2838047394789478669319034731198126012852726800356136421961092967212956347663n,
            y: 109440150751437404689746594530358035690508923769135624711859251310809929033962n,
        },
        {
            x: 5998238336829085566769557118604962715411041384353074669245716808400368927326n,
            y: 78635592513295904537313460627725231274786580269731398349596614721889706264243n,
        },
        {
            x: 31146515767677903001797332651387902212885386884886684684358673519443673841842n,
            y: 99472727300118100559831794558106716135832555721950596043727906771065801781534n,
        },
        {
            x: 6475945805436447455273223508578893860521030578088261380543354866231186942035n,
            y: 93719068425260985508571794404847299486227190402327246544361535507971912522930n,
        },
        {
            x: 60224422617260074981790868193157889594414049603696071842128194974388107848293n,
            y: 6508456399099496394506284749821412945740228064772237876925330331726785307788n,
        },
        {
            x: 12321996259027044300249976721392827019763634909898544936702991109113554672417n,
            y: 70228894328170880093326974098356213833492698284353942042555911760520991315143n,
        },
        {
            x: 54059177184680807718291751567607323600117696001494716311547628732763443101797n,
            y: 30397021121311160748175267034072209735541334392678363028131751253140336779249n,
        },
        {
            x: 15509398460211915393272704735499616362531751093922370432373761917447899887412n,
            y: 113194222376370553965194936371675455401819348664364389753912165021022524571615n,
        },
        {
            x: 79528182740612105563976312517308192853709301241844135442680554447026556888583n,
            y: 1507778177077665742465805958102699320241782179139207713562905626632862044783n,
        },
        {
            x: 103944801652398927479147133314617363842290960469952043918605650404021611634698n,
            y: 46158390840771261015057325747347603069866731328826994982362988952984965630551n,
        },
        {
            x: 6447861791859735360414993754891301216125583011256359279320345339764920251659n,
            y: 88210601960267766907157771697960715346327838614682440190781620583555046135500n,
        },
        {
            x: 33714355081313768034665102765856833566925610915059536110448271965066831181901n,
            y: 31521093636442879844460418291929066735171556617834781582934672934470612303528n,
        },
        {
            x: 38768920446901355087146731064943177174056665507950080728709655907157726535550n,
            y: 65252596183361605463016804427732654330436727997028198810611788121306411028598n,
        },
        {
            x: 99167359816929786891617370326682080909918725638385097040011036860901449512198n,
            y: 76600580073287959381522397721558734442587276131288955814995284643075388073482n,
        },
        {
            x: 100787125477758709611894477413811110536143066611506960456225050091576273260977n,
            y: 80197604815463347959726424437847681650517880569155313770711686422459188738235n,
        },
        {
            x: 103990559961528829024902850551357948995143774110532881982706365252429038814624n,
            y: 53944697478762543190168943023869476502329443433182164573196768012308394188637n,
        },
        {
            x: 90533115654077017366631987797005013883161507854203205042091653880943855591233n,
            y: 13704138333061897648949642665562168253764806273954568418339608481173622824778n,
        },
        {
            x: 81898662548217059330326564099348930954394554600082560257574862437820929412448n,
            y: 70662411570452561661158891724420426392930909845647756762743651001661497723558n,
        },
        {
            x: 43723798054882437701612900405844377854685758068518886780084596302910740899795n,
            y: 68058727992378723366858414975470710436443692109125887170030134222896285143774n,
        },
        {
            x: 103156470459550718867355685018768641968617356334369498902921002305582504723151n,
            y: 13737359480973331512081521545922865420898339774338984457730169350426344119339n,
        },
        {
            x: 20499993916933121244855073267660178217610855936425232835229778969505669478966n,
            y: 112871153932749113477252835467023502066661346160098333850651817698099037662055n,
        },
        {
            x: 25539920499439774108977632177383829074591757262538618252034685492646736205639n,
            y: 92470867287044640261449906820271685783304045195550476958345742825862592284215n,
        },
        {
            x: 30521250754514368541224646659780453680736351859965730130463642325556907451988n,
            y: 88005093077415614006242356050329916446964818651378457607874681808071552385267n,
        },
        {
            x: 30978927491535595270285342502287618780579786685182435011955893029189825707397n,
            y: 20481551163499472379222416201371726725754635744576161296521936142531318405938n,
        },
        {
            x: 73450604269630675300143354721287867787104940331898087301873080305942319031902n,
            y: 61150582011930467138439561607227183610502048913145767873791961751611609242875n,
        },
        {
            x: 18348424709969931834174091430613018498698081298566264338878701168549980217100n,
            y: 47813918924079085448124957596124386029763830498939859267265976337216511217016n,
        },
        {
            x: 55881013555429575228667838642131238672304236081211634755366845332562345107012n,
            y: 63221592520063918995483689622179447143784318408606332570484522880814153536195n,
        },
        {
            x: 65194690247463206667359044308010163235442441467086410025411513881176370439990n,
            y: 21566786170997056470191753989159548456719598145545689483899060425439347748556n,
        },
        {
            x: 75745423571755075857013563556326814022008330821417570737450980444876524118076n,
            y: 35315054069894698977977343586429867932669445251818089281470136146342605022312n,
        },
        {
            x: 11959075684573204015937552593645842756928165756134267817302893911568927293412n,
            y: 26157211179864039776341620129673411161793056652051170182462802718523902858714n,
        },
        {
            x: 115723419473984584623147701470692692146094554906588855825564915356503257565614n,
            y: 93762292507859802278153682785769306474162204126074205026948872220787812088548n,
        },
        {
            x: 52346371197013204429054924636063649166309485559466661811557924144827536847767n,
            y: 13837714228740263282693401806583472847257885100427106907885067792964432738532n,
        },
        {
            x: 50527004416347011221342377467298866798527832281528345314687373305358417671704n,
            y: 111445372607164754672535583963909031427366641949787460759992018572914150540838n,
        },
        {
            x: 96492589715835784751545156270539782761961631976633939717992259349683541744241n,
            y: 52795110863810597341021465530476055169916710778111401489737230952811696276270n,
        },
        {
            x: 83469109831894890598744019511486444866075473978854161898070611304919366536330n,
            y: 84460666371891986218622208269555740228292085679138188016614168221806487271582n,
        },
        {
            x: 70995936869528892699086436342051791094821508520521881324987288133523659350844n,
            y: 25188850222965142155825415252575107153466583668732895564021359825937394124131n,
        },
        {
            x: 114953009523390002611969156201737804084373491796644937381423783915562266324808n,
            y: 36037694058746357372907871368868323557677657002898148960155479710883328221095n,
        },
        {
            x: 92386875489266980279533236713420728194653032587208748429442406357445325642356n,
            y: 115247025104858683641548280600497247219326832707021648710733948426339403021787n,
        },
        {
            x: 63515627582664604658617520962278977767753946677272678445827196012896255554427n,
            y: 72888513457272300899307229642859584174419869600152522192403950931637944470206n,
        },
        {
            x: 112228992901179912293628150016219261272876035178879527089071247139242795299181n,
            y: 99733721457467590523432373406435321475591824701196331116730341190616408597505n,
        },
        {
            x: 52627137221759087716759326373670514926676623053969757153734311436114871227705n,
            y: 62044214734951907813136129687912992638755121041560574201302644030702830082431n,
        },
        {
            x: 20856720085424571615357750906976041078400746175542527608169624161530751934439n,
            y: 89631904293663505724844335202868216616249335657009342959560087381462415728426n,
        },
        {
            x: 63561395604219527017659648407864108653332664319982531376272886045939837573235n,
            y: 41634288414000102967636713951218971695055302995517544007608273434900360958272n,
        },
        {
            x: 60341943853052314831384980963169283530158511568775653965535652867440947579770n,
            y: 14793911978848054261172124802488562976074258965246462676500800968598227911878n,
        },
        {
            x: 58314205011487618461208654883714796849540704377600010940108854090495974131175n,
            y: 110428083325366657232019270830044186811285074557164307760332644267681307091951n,
        },
        {
            x: 101934812181613044509434567605128382412202993153329303650025320742389024173012n,
            y: 69890809653677237901402372049613394543654373254278174160668563891555824594872n,
        },
        {
            x: 104773206448657881791061219900483282291021178457651080639911460842634930527333n,
            y: 38092710118850121703307323485604242502666357651408144580556056661569407807068n,
        },
        {
            x: 7785993606773333792193679352390105545968002031986568815324935175900910554134n,
            y: 56956191094375988786905683381974353865692849880243256252184579681574147621159n,
        },
        {
            x: 8116822610398092475998261755721252881826312002545550542589408849431001643383n,
            y: 77615394791202213797041483285822748436124305014454644942117488897224040860529n,
        },
        {
            x: 66625219663417922127724112992742305031056820896481273845027222854330510633622n,
            y: 60346585571218156384746575751898534149661500711605741243210212105278516115693n,
        },
        {
            x: 34829030475012836784453221158008133968249818536542916614028773933286104041160n,
            y: 28731115804662672266184499596899773159546472552762873574325701468089677621804n,
        },
        {
            x: 5957715443083668616616242406163441213924386189872369707339482305536594969386n,
            y: 5732088496556037984236426437053912494964436854513274075189712733372298613628n,
        },
        {
            x: 60155716148845326444961595850523686137202733727897468112203772061227419895229n,
            y: 109279020496393734257475148601906358846792180552605151393748532416018470124457n,
        },
        {
            x: 42307211814129790972102075664908295575367191580291932715683092381746054475651n,
            y: 68315533366849832176368205251338455461373039189304100101680556857886213611450n,
        },
        {
            x: 75482836583695966294749302644878160539295469365070657321392897188033831340148n,
            y: 5494329853731381479319378147147813735961104757123631046139701090992848858543n,
        },
        {
            x: 62566479406992028833701513127517003117705273657914355007164325641786804940586n,
            y: 1960762099875877323026688903614507008077244983723853261330124348966713726135n,
        },
        {
            x: 35590714910481985980832674257484279773460163867896489266772339672524939689782n,
            y: 74393902097046012023527315703773902429391932469688996680792948386158391139395n,
        },
        {
            x: 89590076941279197775029512410275925788452634424883985419130022317730920797435n,
            y: 105898380109845963781567152507219069988357966515080316336353507378968111480823n,
        },
        {
            x: 82704786903994166551769883043198932442517513271646396435462350052485219838852n,
            y: 66940971316055910924718629286678560701660747130391762982171106478702675348257n,
        },
        {
            x: 78420740009908648362631232572697179746407950620615429506161937198227081578525n,
            y: 54146476730951464413432886412294957685163383490776066241635843582390201419229n,
        },
        {
            x: 57114130960722365644612808986741417839294033741825093571973433828554694293067n,
            y: 63655855556813809724203158849430282541212748253259803805017778390202858009335n,
        },
        {
            x: 79188927587733924976456891252160949609968127911757261527618306248487461773374n,
            y: 112622710477543563944865978371032399598381012758060446260122423016491956620066n,
        },
        {
            x: 98669946778909963127929659531564569041060332795475447057002278251210100440249n,
            y: 104636273706010026253431042836552793641630425915308150898707756630116959684255n,
        },
        {
            x: 82717459767454249683072897032847031229176136207207958455822059572581863039493n,
            y: 85805433368587367880126356575098861654724609093913266103811978519729986039045n,
        },
        {
            x: 75124843962754790633452898889484811582276949762746319956852118628479948094532n,
            y: 1805043475221707374709459035970649301929483884893326659386304711906307593742n,
        },
        {
            x: 17839075883838788918804801373138264917046380773655628556698492684995502517924n,
            y: 39519236562696431827343074621909077611815202266598327094513568871109342801199n,
        },
        {
            x: 56507754881113459828864536534950201267045031999715036031156456269465231056818n,
            y: 21825750820896722550617279123691071450484347229369213523261884129530104396326n,
        },
        {
            x: 31501239079985367817809052122201302301185843477636189915804404432506284823263n,
            y: 52351780531069194836078281550514355174146707381687785820248897949973423767916n,
        },
        {
            x: 34747923689135230620768472288049520738505976901872548222869584238042690085962n,
            y: 48339229328418927123590421395192865219875669140111339256944150416282240009101n,
        },
        {
            x: 52613159587243514993245538185564488740909362265938089220404626133235311688256n,
            y: 10052284581656657088003140496171905220992719153519115103497980934931277733113n,
        },
        {
            x: 2515742134643147188310703483852422049068948625704851576384863455282657707382n,
            y: 65553971276822875509378124761075939054975163239363496047572555229591149547166n,
        },
        {
            x: 14871719712342859160997617440955660397550360063440050957787357544752195499387n,
            y: 115522999277858285232599478460575039716918995182448551431431483484331171098598n,
        },
        {
            x: 35699222965481121134484164419245667021550670950605271702199038248925815507029n,
            y: 78195317130131731699003800627049051262175773987291187060915682236695784193311n,
        },
        {
            x: 30248887521975972647145688819661848468345025816336074631302329522981049758251n,
            y: 20753123599359878132673099000928385880820251305397548080723294688134937867974n,
        },
        {
            x: 3190199734463742982794596204281061771714887864625021997129592530189910198532n,
            y: 70365339751001738145118000874518091361489791201527431148667518224993958441327n,
        },
        {
            x: 41889769652146145141954049193142456380322364778972849318130785407890761398927n,
            y: 60129121744927255616268158043967366722611367692346486122233277185153521159534n,
        },
        {
            x: 6443079358792348613223398358132475650297078350977575986545107970424353624542n,
            y: 9022843309389148181922332795480212965717488318910555830606492602682755446092n,
        },
        {
            x: 69848184455631926658718631134599719964892018306813542689716062268273303416186n,
            y: 107479627069015150219830504850177664802259527708061146723676286069134723426094n,
        },
        {
            x: 107243457939635538384138770050026556799106876373927783734225297269724288811143n,
            y: 93965180063578933030582000549084365428810208468274549090017466203106090935639n,
        },
        {
            x: 84582205370005874077518281568406727210306111666141917327302932152103889682099n,
            y: 7083716223479420784268023608336111553799478968134901287459017916559339090823n,
        },
        {
            x: 91811423037535315823966266680655763187672994707546225106355143709452149020671n,
            y: 19384045470263198705988555595975910311529577234345939599017429037875607800200n,
        },
        {
            x: 62095071921331057293770869233419188155217220305468971235948602611784337796345n,
            y: 96074082882272063067501634663827867673831688084195313470200920129652099882299n,
        },
        {
            x: 31770658249183730736107156763238755833390511105181092763728332792636710980962n,
            y: 28975320751067943611152774064743601571609748363389104657497886983630244356479n,
        },
        {
            x: 3019831764837091358356839084120725873763941559189221237511043338897833660673n,
            y: 20515821376132185355823588093215017734619311459606616386719037322790010322676n,
        },
        {
            x: 111424284590045334357948298917427826771954331315877406415371050100220617275440n,
            y: 58107463960559813061745320872156075090265693614828509419896376366924580361211n,
        },
        {
            x: 103322868297895748410588757856740228375773307095209613574309422046254257381712n,
            y: 16825351819968730201165269882673154319278853846462687165686479266578696967071n,
        },
        {
            x: 7453033841566091259703286217562220811804594786027273549821141426875407779006n,
            y: 50040872125110927311440960613479467895486664236138444792548885949990011961564n,
        },
        {
            x: 75457776083317821252662798697757590755920885718289763058263534551782236039358n,
            y: 46728718496393669138731607516029863508010621830530871863089645384465424840180n,
        },
        {
            x: 28507834610654566637594510161138892506432594947274618437317219361070848981768n,
            y: 3950927579959704485379855502273046145130032444601645974019069495340412976281n,
        },
        {
            x: 106918977496937714720284163058033002522801120928276972663745392498681798181500n,
            y: 1346539278960570545851414518155188004217509775692549416990760340077370277457n,
        },
        {
            x: 69871290583902823756312358757194974531816844293401433072353406819188419207248n,
            y: 105635023119392007220470460253250131344596988052532839563748788415404510957778n,
        },
        {
            x: 77864691330202459269902368496005209379006968282786573914904654712475827357437n,
            y: 106644442817744962331702755418260381092819993571920131637117762803846999115073n,
        },
        {
            x: 81599715584362650893447932744322012484666594684505550956455559349542388641596n,
            y: 99766301412387272861178977703277751379739157429023239152870301701672855369110n,
        },
        {
            x: 66478773221908918278722210031252895095482013672559153521171857527634103402125n,
            y: 86564114445956040324099279057218608260692883271130180360695016606602941633157n,
        },
        {
            x: 42017372884146984764287866115230763688662811432217589804162678605023875628138n,
            y: 43881641692081361449645723218237242169945727392394611858792411669752373426598n,
        },
        {
            x: 18237953952471228309905291387835273685646523595235494003618377407641490164654n,
            y: 54459089004298369762383803595673620255175363628672685417955970876315516578711n,
        },
        {
            x: 99396755068882597527021433329527587778905738553717991869252233907309271361959n,
            y: 4151213505703552323484051783518929626698166629645106743412916780028459018091n,
        },
        {
            x: 65176742594137028664555658659604230235988532986813762092234811340062511847213n,
            y: 91260320805244932943515016743783414530070331789503984890762416515154848435816n,
        },
        {
            x: 107574619740572235740088625130724224308024164419092963927777137070893506995714n,
            y: 16953515622653454918579528062262011587143829245619588294066458760602791442835n,
        },
        {
            x: 88856071091439577644782525022510380676652931946097403441905072574691472303345n,
            y: 29630121943367788284420912620448177185473971189923200003968137098575043680937n,
        },
        {
            x: 31347675290603604979830395473396103680863501118615141614786768832129466250295n,
            y: 8725209334632424771796767284423634905919908441143251928422639726125967129574n,
        },
        {
            x: 6699767763983537786185719971110523953698720998672949122535504506105431893401n,
            y: 58437980416534286022010244821736997611847971586562019051444538879605504796962n,
        },
        {
            x: 109062811435070031105352308473727228576792070602323172007786676799030240152609n,
            y: 94986180201575643059713359593457702086786770416142227838783293921350027999968n,
        },
        {
            x: 38823327757628624724089628891002757420915028675684770719291136547692318799967n,
            y: 39545809553270835688737613624365890833564499219726466994068294581334328578927n,
        },
        {
            x: 29672974943102342268093654538777318652314507658860930799795262291229941502293n,
            y: 16050350723103250890473913864431532585275791087270048112011424268709066816455n,
        },
        {
            x: 73312659727769531011175417094693448994338362020675320254704919199523549384500n,
            y: 3659868342108671616420766988896032156940574525191375826023786530716613787379n,
        },
        {
            x: 99608527373668486894774583091448414223068909806704438431859012280792112713774n,
            y: 37281159542798796194087229681860881059588629746616284953535068803570255797839n,
        },
        {
            x: 61632086041191113681842353315758156479413883008474627124275768806982846331174n,
            y: 111933754969036247264000782324196617267809866719838001327903399156380786533709n,
        },
        {
            x: 54552719204485761456045352201742865565560553175869682161139305270484486776373n,
            y: 9140772117376008435777854489687833451258457525452397813142257003104926526902n,
        },
        {
            x: 61404737936922832308349079333831921454556097873261543061318639798427581002188n,
            y: 57030874657725005175698257045198664565627401861923757947677706186652432026988n,
        },
        {
            x: 18092543136954941682619822837331188262028896935662242481007319704782520288381n,
            y: 7055180967965002763158816345289836898907528226086457408634615501615707037402n,
        },
        {
            x: 81680541308571005379812615247853250562857713301074313241019903853270181093307n,
            y: 114362542583756471504012178190304513583580625083513187075495838719049513922840n,
        },
        {
            x: 74233407337680620955431053000891891479917363059538256779508968528867004255065n,
            y: 36574075506151029705097561057618238328869821855955277917031736027599178985237n,
        },
        {
            x: 86918379286730813404742648346594707581365394634393858072843756052697379505145n,
            y: 64558221901794699608373568337782818153567050029843807329178389260034636611760n,
        },
        {
            x: 83602459045807251534781533573081878945960162437142795680192563283945387101491n,
            y: 100796919476508984083797843249539804149185341809964728733444481681293150759918n,
        },
        {
            x: 94477851059460455374144545095524086145491386676833656657946356827403603599839n,
            y: 2990570528778462168034318511266480684980306827005471533988189049155652587454n,
        },
        {
            x: 33369713605395896868113063826572022966906975870583926314412405318380550800088n,
            y: 113750931263973947912004928450109131748533234128808512257097347558188429782760n,
        },
        {
            x: 104933229839295883364066761002189271504011222694422524330566764873049588166784n,
            y: 48185041986269240445195008260916082897393802288889058392724603854552673411883n,
        },
        {
            x: 71470699740315574377934583206740265848474311277452399385266271520812042446639n,
            y: 96855356267175287585442651619462057231770436524740499495318232565556062933037n,
        },
        {
            x: 47476452820719945936524819032622318587487722681099356096892784008519876992775n,
            y: 92218806925569787283702304838387293055019874979186897299806248868160486843989n,
        },
        {
            x: 102088508503241988948738789361573287535104421985720095959409867361415279501255n,
            y: 13867393705028381320343939099063849566553892969797110129292587477834512039972n,
        },
        {
            x: 67956812517957619530559639861388213651806866875893862159859552503289085868670n,
            y: 41617600021942546319896319558324517590373053075054017854495959562600278948288n,
        },
        {
            x: 50494456979015851591146455163703146084821583997460172567932848022916243480745n,
            y: 71794151723658257812223551962133486278910944450631501844380279813343487010647n,
        },
        {
            x: 57705892077276062839808510623398523839594853506908237282010509423675271946036n,
            y: 94457565991902704059304731525788444606941403905936814706355518176780333638636n,
        },
        {
            x: 977363431902279983511413328810902973013889653410506689969425164281657973723n,
            y: 7559293095779737796397528707783546466936683201078066916192452841605828859634n,
        },
        {
            x: 111554164212851840659875687974858198973484951725316563828567925555782593062020n,
            y: 51303179497481860047085093074256641655975840562054153656202591460578424754449n,
        },
        {
            x: 67195356633987340697890800635752445150915642249410384436846819913591347547044n,
            y: 69080186722486290814833357816411432639323015039679176935284114014875483815439n,
        },
        {
            x: 70662918321536339090997905770396191995273073181405541350096759435296489964675n,
            y: 108823196633188149137819460609930424574751275382951527771866266641585197043963n,
        },
        {
            x: 92172944497781465926255599623771619865671213159402207332904479347755137836991n,
            y: 85764047530883515606367203115969335080809076009794235563499392207056042921894n,
        },
        {
            x: 63316608173468118724149612578297591597569473951953621385465518698697339706541n,
            y: 97390651688858555476647252267069620646386715982491329369290600283610813563198n,
        },
        {
            x: 83268160173775039542270543586965919133148816314643357216772068993739693177747n,
            y: 84584596100581360414438884328935749623010950154285597858142419627677505088214n,
        },
        {
            x: 27849962393583532263451935174934350405445826971563438711913885457499949683940n,
            y: 95516861072095509540784639710706879044411490169907155423865079203193850491091n,
        },
        {
            x: 38591043664836880000062646893865410690639226199560783627355905150836068598423n,
            y: 21560781697793744852799507816348690962536645919403493958039251273758371297289n,
        },
        {
            x: 48222033250298455596924443498979688533086840389735288287611443200432594245826n,
            y: 107581973818970608545461571441133676930897669957047181971073251061767676302485n,
        },
        {
            x: 98925742998032343163578111927632341491010944802014499785340876803440853109749n,
            y: 68735293371422930088457824364248567234549234771565866989749068416028549249818n,
        },
        {
            x: 110837144128901960856813468474683267891097417247322458022958101501177553128931n,
            y: 102542545326870488406122637834950408695143512695127077568115820092567916066184n,
        },
        {
            x: 19033424389305135287249839334942765117296257388174774755647098437782648681628n,
            y: 76952112030978774060491203582608057724443936452082041259555119223867084258546n,
        },
        {
            x: 4682644908373517149416771959853019476368614823296309830224093764604745099964n,
            y: 111757570815137984128113458254566020129858295042171301796956201045072030778362n,
        },
        {
            x: 111219377186389570333596186545996324271115378038305817824370988355996583896525n,
            y: 53739775268079159239282568740511048076756387010726830157349069076631808249780n,
        },
        {
            x: 1874966432829767683846519858202661138642061850499423808957733922079734484916n,
            y: 90940583293135011500500484671671492948438921247427773700955370613092170292515n,
        },
        {
            x: 79988085088690463838155666374498482223435986755429847680394074285297852177035n,
            y: 111414527427082145430636999484024785626653818310076851262396480429653474216675n,
        },
        {
            x: 1830366744568519762943837437141664986810918431042354631665780294645297142152n,
            y: 105257613621278023445701883922226026661545311518311199138337996416201809658315n,
        },
        {
            x: 25027234219844032948734529607188389474708428490005127355328347559215491823005n,
            y: 16627745655880780532108160490313118993721260832879970061001444143983638512793n,
        },
        {
            x: 70446006630448671453312245496455575186752777019685716972648964146132978482500n,
            y: 12573764772221723909770231057264019418514349848606849784881394807994589200008n,
        },
        {
            x: 112596371597197100889482377337362517161391915316287673230561898602230266265605n,
            y: 68579117379619519081561212243653155051822368535173673057186209172486927593438n,
        },
        {
            x: 86115541063453062664904347350919270964540281718267737523124608095330066183051n,
            y: 14054157768262882440425378598826979901911976547202204459995245142275106278021n,
        },
        {
            x: 114034844299635899562802814542057780470060700988245781534902226999959535474718n,
            y: 49381382680292673413075761648423479969616095939071722660799106811390519599594n,
        },
        {
            x: 80143616622933388569458864890062131358674428602545615425774818573549447152712n,
            y: 1304413387522005593658644986431870580741763784891793039747684854470403546711n,
        },
        {
            x: 43571678054870652892977980703416468486567639676451044763536517937451273544315n,
            y: 49954115042924243391312436036996713150425283228309118668010174666521820679010n,
        },
        {
            x: 873704202273142968625579162198467507032750183849493641986922225446071932933n,
            y: 67998537520975131039647709652900653944752336764739237101720732749663019388079n,
        },
        {
            x: 54139800690483426297301952631437925110587960422887277029841182266555965057876n,
            y: 74115984295944166045948184427653282211014700048525035879938298669454420895743n,
        },
        {
            x: 5020455767449249521318142673103379929932104188174155071185162992986202608202n,
            y: 74462411220784035193134971991304486214774552560095008269501393017494332267103n,
        },
    ]

    @method()
    static comparePoints(p: Point, q: Point): boolean {
        return p.x == q.x && p.y == q.y
    }

    @method()
    static modReduce(x: bigint, modulus: bigint): bigint {
        const res = x % modulus
        return res < 0 ? res + modulus : res
    }

    @method()
    static modInverseBranchlessP(x: bigint): bigint {
        // This will get substituted by optimized ASM code at transpilation stage.
        // The bellow code is ran while executing in a JS context.
        return SECP256R1.modInverseEGCD(x, SECP256R1.P)
    }

    @method()
    static modInverseBranchlessN(x: bigint): bigint {
        // This will get substituted by optimized ASM code at transpilation stage.
        // The bellow code is ran while executing in a JS context.
        return SECP256R1.modInverseEGCD(x, SECP256R1.n)
    }

    @method()
    static modInverseEGCD(x: bigint, m: bigint): bigint {
        // This will get substituted by optimized ASM code at transpilation stage.
        x = SECP256R1.modReduce(x, m)

        let t = 0n
        let newt = 1n
        let r = m
        let newr = x

        let quotient = 0n
        let tmp = 0n
        for (let i = 0; i < SECP256R1.UB; i++) {
            if (newr != 0n) {
                quotient = r / newr

                tmp = newt
                newt = t - quotient * newt
                t = tmp

                tmp = newr
                newr = r - quotient * newr
                r = tmp
            }
        }

        if (t < 0) {
            t = t + m
        }

        return t
    }

    @method()
    static negatePoint(p: Point): Point {
        return {
            x: p.x,
            y: SECP256R1.modReduce(p.y * -1n, SECP256R1.P),
        }
    }

    @method()
    static doublePoint(p: Point): Point {
        const lambda =
            (3n * p.x * p.x + SECP256R1.a) *
            SECP256R1.modInverseBranchlessP(2n * p.y)

        const rx = SECP256R1.modReduce(lambda * lambda - 2n * p.x, SECP256R1.P)
        const ry = SECP256R1.modReduce(lambda * (p.x - rx) - p.y, SECP256R1.P)

        return {
            x: rx,
            y: ry,
        }
    }

    @method()
    static addPoints(p: Point, q: Point): Point {
        let ret: Point = {
            x: 0n,
            y: 0n,
        }

        if (p.x == 0n && p.y == 0n) {
            // if P == inf -> P + Q = Q
            ret = q
        } else if (q.x == 0n && q.y == 0n) {
            // if Q == inf -> P + Q = P
            ret = p
        } else {
            let N = 0n
            let D = 0n
            if (p.x == q.x && p.y == q.y) {
                // P == Q
                N = 3n * p.x * p.x + SECP256R1.a
                D = 2n * p.y
            } else {
                N = q.y - p.y
                D = q.x - p.x
            }

            const lambda = SECP256R1.modReduce(
                N * SECP256R1.modInverseBranchlessP(D),
                SECP256R1.P
            )

            const rx = SECP256R1.modReduce(
                lambda * lambda - p.x - q.x,
                SECP256R1.P
            )
            const ry = SECP256R1.modReduce(
                lambda * (p.x - rx) - p.y,
                SECP256R1.P
            )

            ret = {
                x: rx,
                y: ry,
            }
        }

        return ret
    }

    @method()
    static mulByScalar(p: Point, m: bigint): Point {
        // Double and add method.
        // Lowest bit to highest.
        let q: Point = {
            x: 0n,
            y: 0n,
        }

        for (let i = 0; i < SECP256R1.CURVE_BITS; i++) {
            const mask = lshift(1n, BigInt(i))
            if (and(m, mask) != 0n) {
                q = SECP256R1.addPoints(q, p)
            }

            p = SECP256R1.doublePoint(p)
        }

        return q
    }

    @method()
    static mulGeneratorByScalar(m: bigint): Point {
        // Fixed-point scalar multiplication for the curve generator point.
        let q: Point = {
            x: 0n,
            y: 0n,
        }

        for (let i = 0; i < SECP256R1.CURVE_BITS; i++) {
            const mask = lshift(1n, BigInt(i))
            if (and(m, mask) != 0n) {
                q = SECP256R1.addPoints(q, SECP256R1.DOUBLINGS_G[i])
            }
        }

        return q
    }

    @method()
    static verifySig(data: ByteString, sig: Signature, pubKey: Point): boolean {
        // Hash message.
        const hash = hash256(data)

        const hashInt = unpack(
            //reverseBytes(hash, 32) //.+(toByteString('00'))
            reverseBytes(hash, 32) + toByteString('00')
        )

        assert(
            sig.r >= 1n &&
                sig.r < SECP256R1.n &&
                sig.s >= 1n &&
                sig.s < SECP256R1.n
        )

        const sInv = SECP256R1.modInverseBranchlessN(sig.s)
        const u1 = SECP256R1.modReduce(hashInt * sInv, SECP256R1.n)
        const u2 = SECP256R1.modReduce(sig.r * sInv, SECP256R1.n)

        const U1 = SECP256R1.mulGeneratorByScalar(u1)
        const U2 = SECP256R1.mulByScalar(pubKey, u2)
        const X = SECP256R1.addPoints(U1, U2)

        return sig.r == X.x
    }
}
